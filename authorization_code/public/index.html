<!doctype html>
<html>
  <head>
    <title>Moodify</title>
    <link rel="stylesheet" href="index.css">
    <style type="text/css">
      #login, #loggedin {
        display: none;
      }
      .text-overflow {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 500px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div>
        <style>
          .tooltip {
            position: relative;
            display: inline-block;
          }
          
          .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            /*background-color: black;*/
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
          
            /* Position the tooltip */
            position: absolute;
            z-index: 1;
          }
          
          .tooltip:hover .tooltiptext {
            visibility: visible;
          }
          .size_of_img{
          width:90px}
          </style>
          
          <body style="text-align:center;">
          
          <div class="tooltip"><img class="size_of_img" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iNTAiIGhlaWdodD0iNTAiCnZpZXdCb3g9IjAgMCA1MCA1MCIKc3R5bGU9IiBmaWxsOiMwMDAwMDA7Ij48cGF0aCBkPSJNIDI1IDIgQyAxMi4zMDkyOTUgMiAyIDEyLjMwOTI5NSAyIDI1IEMgMiAzNy42OTA3MDUgMTIuMzA5Mjk1IDQ4IDI1IDQ4IEMgMzcuNjkwNzA1IDQ4IDQ4IDM3LjY5MDcwNSA0OCAyNSBDIDQ4IDEyLjMwOTI5NSAzNy42OTA3MDUgMiAyNSAyIHogTSAyNSA0IEMgMzYuNjA5ODI0IDQgNDYgMTMuMzkwMTc2IDQ2IDI1IEMgNDYgMzYuNjA5ODI0IDM2LjYwOTgyNCA0NiAyNSA0NiBDIDEzLjM5MDE3NiA0NiA0IDM2LjYwOTgyNCA0IDI1IEMgNCAxMy4zOTAxNzYgMTMuMzkwMTc2IDQgMjUgNCB6IE0gMjUgMTEgQSAzIDMgMCAwIDAgMjIgMTQgQSAzIDMgMCAwIDAgMjUgMTcgQSAzIDMgMCAwIDAgMjggMTQgQSAzIDMgMCAwIDAgMjUgMTEgeiBNIDIxIDIxIEwgMjEgMjMgTCAyMiAyMyBMIDIzIDIzIEwgMjMgMzYgTCAyMiAzNiBMIDIxIDM2IEwgMjEgMzggTCAyMiAzOCBMIDIzIDM4IEwgMjcgMzggTCAyOCAzOCBMIDI5IDM4IEwgMjkgMzYgTCAyOCAzNiBMIDI3IDM2IEwgMjcgMjEgTCAyNiAyMSBMIDIyIDIxIEwgMjEgMjEgeiI+PC9wYXRoPjwvc3ZnPg==" alt="Image 1" /><span class="tooltiptext">Moodify allows a Spotify user to view their top Artists, Genres, and Songs. Utilizing the Spotify API, our website also helps user's visualize their taste in music by providing a moodboad based on preferences.  </span></div>
                    
          </body>
      </div>
      <div id="login">
        <h1>Moodify</h1>
        <div class="button-container">
        <a href="/login" class="button">Log in with Spotify</a>
        </div>
        <footer>Made By: Rachel Pham, Adrian Khor, Harchet Singh, and Gency Dela Torre</footer>
        </div>
      </div>
      <div id="loggedin">
        <div id="user-profile">
        </div>
        <div id="user-topArtists">
        </div>
        <div id="user-topGenres">
        </div>
        <div id="user-topSongs">
        </div>
        <div id="oauth">
    </div>

    <script id="user-profile-template" type="text/x-handlebars-template">
      <h2>Welcome to Moodify, {{display_name}}!</h2>
      <a href="{{external_urls.spotify}}"><img class="prof-pic" width="200" src="{{images.0.url}}" /></a>
    </script>

    <script id="user-topArtists-template" type="text/x-handlebars-template">
      <h3>TOP ARTISTS</h3>
      <div class="border">
          <img class="pic" style="overflow:auto" width="150" src="{{items.0.images.0.url}}" />
        <div class="border2">
        <div class="info">
            <ol>
            <li>{{items.0.name}}</li>
            <li>{{items.1.name}}</li>
            <li>{{items.2.name}}</li>
            <li>{{items.3.name}}</li>
            <li>{{items.4.name}}</li>
          </ol>
        </div>
      </div>
      </div>

      <h3>TOP GENRES</h3>
      <div class="border">
        <div class="border2">
        <div class="info">
            <ol>
            <li>{{items.0.genres}}</li>
            <li>{{items.1.genres}}</li>
            <li>{{items.2.genres}}</li>
            <li>{{items.3.genres}}</li>
            <li>{{items.4.genres}}</li>
          </ol>
        </div>
      </div>
      </div>
    </script>

    <script id="user-topSongs-template" type="text/x-handlebars-template">
      <h3>TOP SONGS</h3>
      <div class="border">
          <img class="pic" style="overflow:auto" width="150" src="{{items.0.album.images.0.url}}" />
        <div class="border2">
        <div class="info">
            <ol>
            <li>{{items.0.name}} by {{items.0.artists.0.name}}</li>
            <li>{{items.1.name}} by {{items.1.artists.0.name}}</li>
            <li>{{items.2.name}} by {{items.2.artists.0.name}}</li>
            <li>{{items.3.name}} by {{items.3.artists.0.name}}</li>
            <li>{{items.4.name}} by {{items.4.artists.0.name}}</li>
          </ol>
        </div>
      </div>
      </div>

      <h3>MOODBOARD</h3>
      <div class="border">

      <img class="moodboard" style="overflow:auto" width="700" src= "../images/moadboard/moadboard.jpg" />
      </div>

      
    </script>

    

    

    <script id="oauth-template" type="text/x-handlebars-template">
      <!--<h3>oAuth info</h3>
      <dl class="info">
        <dt>Access token</dt><dd class="text-overflow">{{access_token}}</dd>
        <dt>Refresh token</dt><dd class="text-overflow">{{refresh_token}}</dd>
      </dl>-->
    </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script>
      (function() {

        /**
         * Obtains parameters from the hash of the URL
         * @return Object
         */
        function getHashParams() {
          var hashParams = {};
          var e, r = /([^&;=]+)=?([^&;]*)/g,
              q = window.location.hash.substring(1);
          while ( e = r.exec(q)) {
             hashParams[e[1]] = decodeURIComponent(e[2]);
          }
          return hashParams;
        }



        var userProfileSource = document.getElementById('user-profile-template').innerHTML,
            userProfileTemplate = Handlebars.compile(userProfileSource),
            userProfilePlaceholder = document.getElementById('user-profile');

        var userTopArtists = document.getElementById('user-topArtists-template').innerHTML,
            userTopArtistsTemplate = Handlebars.compile(userTopArtists),
            userTopArtistsPlaceholder = document.getElementById('user-topArtists');

        var userTopSongs = document.getElementById('user-topSongs-template').innerHTML,
            userTopSongsTemplate = Handlebars.compile(userTopSongs),
            userTopSongsPlaceholder = document.getElementById('user-topSongs');

        var oauthSource = document.getElementById('oauth-template').innerHTML,
            oauthTemplate = Handlebars.compile(oauthSource),
            oauthPlaceholder = document.getElementById('oauth');

        var params = getHashParams();

        var access_token = params.access_token,
            refresh_token = params.refresh_token,
            error = params.error;

        if (error) {
          alert('There was an error during the authentication');
        } else {
          if (access_token) {
            // render oauth info
            oauthPlaceholder.innerHTML = oauthTemplate({
              access_token: access_token,
              refresh_token: refresh_token
            });

            $.ajax({
                url: 'https://api.spotify.com/v1/me',
                headers: {
                  'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                  userProfilePlaceholder.innerHTML = userProfileTemplate(response);

                  $('#login').hide();
                  $('#loggedin').show();
                }
            });
            $.ajax({
                url: 'https://api.spotify.com/v1/me/top/artists?time_range=short_term&limit=5',
                headers: {
                  'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                  userTopArtistsPlaceholder.innerHTML = userTopArtistsTemplate(response);

                  $('#login').hide();
                  $('#loggedin').show();
                }
            });
            $.ajax({
                url: 'https://api.spotify.com/v1/me/top/tracks?time_range=short_term&limit=5',
                headers: {
                  'Authorization': 'Bearer ' + access_token
                },
                success: function(response) {
                  userTopSongsPlaceholder.innerHTML = userTopSongsTemplate(response);          
                  $('#login').hide();
                  $('#loggedin').show();
                }
            });
          } else {
              // render initial screen
              $('#login').show();
              $('#loggedin').hide();
          }

          document.getElementById('obtain-new-token').addEventListener('click', function() {
            $.ajax({
              url: '/refresh_token',
              data: {
                'refresh_token': refresh_token
              }
            }).done(function(data) {
              access_token = data.access_token;
              oauthPlaceholder.innerHTML = oauthTemplate({
                access_token: access_token,
                refresh_token: refresh_token
              });
            });
          }, false);
        }
      })();
    </script>
  </body>
</html>



<!-- <script id="user-profile-template" type="text/x-handlebars-template">
  <h2>Welcome to Moodify, {{display_name}}</h2>
  <img class="prof-pic" width="200" src="{{images.0.url}}" />
  <div class="user-block">
    <div class="user-profile-left">
        <ul>
        <h4><li>Display name</li></h4><dd class="clearfix">{{display_name}}</dd>
        <h4><li>Spotify Id</li></h4><dd>{{id}}</dd>
        </ul>
      </div>
    <div class="user-profile-right">
      <ul>
        <h4><li>Your Spotify Link</li></h4><dd><a href="{{external_urls.spotify}}">{{display_name}}'s Link</a></dd>
        <h4><li>Country</li></h4><dd>{{country}}</dd> 
      </ul>
    </div>
  </div>
</script> -->